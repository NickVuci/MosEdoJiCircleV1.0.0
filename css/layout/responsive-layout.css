/* ================= RESPONSIVE LAYOUT SYSTEM ================= */
/* Single source of truth for all layout and responsive behavior */
/* Mobile-first approach with landscape/portrait adaptive behavior */

/* ===== MOBILE BASE (DEFAULT) ===== */
/* All base styles optimized for mobile devices */

/* Main Layout Container */
#main-wrapper {
    flex: 1 0 auto;
    display: flex;
    flex-direction: column-reverse; /* Mobile: controls at bottom */
    height: 100vh;
    min-height: 0;
}

/* Sidebar - Mobile: Vertical stacking container */
#sidebar {
    /* Mobile-first defaults */
    width: 100vw;
    max-width: 100vw;
    min-width: 0;
    height: auto;
    max-height: var(--sidebar-height-mobile, 60vh); /* Use responsive token */
    background: var(--control-background);
    border-right: none;
    border-top: 1px solid var(--module-border);
    border-bottom: none;
    display: flex;
    flex-direction: column; /* Changed from row to column for vertical stacking */
    align-items: stretch;
    padding: var(--space-sm);
    gap: var(--module-spacing-mobile, var(--space-sm)); /* Use responsive spacing */
    box-sizing: border-box;
    z-index: 2;
    overflow-x: hidden; /* Changed from auto to hidden */
    overflow-y: auto; /* Changed from hidden to auto */
    position: static;
    bottom: 0;
    top: auto;
    scroll-snap-type: y proximity; /* Changed from x to y */
    scrollbar-width: thin;
    -webkit-overflow-scrolling: touch;
    box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.05);
}

/* Main Content Area */
#main-content {
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    min-width: 0;
    min-height: 0;
    overflow: hidden;
    height: var(--content-height-mobile, 40vh); /* Use responsive token */
}

/* Controls Section */
#controls {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    background-color: var(--control-background);
    padding: var(--space-sm);
}

/* Visualization Section */
#visualization {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    flex: 1;
    min-height: 0;
}

#visualization svg {
    display: block;
    margin: 0 auto;
    width: 100%;
    height: 100%;
    max-height: 100%;
    max-width: 100%;
}

/* Mobile Module Styles - Vertical stacking instead of horizontal scrolling */
.module,
.control-module {
    width: 100%;
    margin: 0 0 var(--space-sm) 0;
    flex-shrink: 0;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
}

/* Mobile scroll indicator - removed as no longer needed for vertical layout */
/* #sidebar::after removed - vertical layout doesn't need horizontal scroll indicator */

/* Mobile last module margin - removed as no longer needed */
/* No special margin needed for last module in vertical layout */

/* ===== LANDSCAPE MODE (WIDE SCREENS) ===== */
/* When aspect ratio is wider than tall - sidebar on RIGHT side */
@media (min-aspect-ratio: 1.05/1) {
    /* Main Layout: Switch to side-by-side with sidebar on RIGHT */
    #main-wrapper {
        flex-direction: row-reverse; /* Landscape: sidebar on RIGHT side */
    }
    
    /* Sidebar: Vertical layout on the right */
    #sidebar {
        width: var(--sidebar-width-tablet, 250px); /* Use responsive token */
        min-width: 180px;
        max-width: 320px;
        height: 100vh;
        max-height: 100vh;
        border-left: 1px solid var(--module-border); /* Left border for right-side sidebar */
        border-right: none;
        border-top: none;
        border-bottom: none;
        flex-direction: column;
        overflow-x: visible;
        overflow-y: auto;
        position: sticky;
        top: 0;
        bottom: auto;
        scroll-snap-type: none;
        scrollbar-width: auto;
        box-shadow: -2px 0 5px rgba(0, 0, 0, 0.05); /* Left shadow for right-side sidebar */
        gap: var(--module-spacing-tablet, var(--space-sm)); /* Use responsive spacing */
    }
    
    /* Main Content: Full height in landscape */
    #main-content {
        height: 100vh; /* Landscape: full viewport height */
    }
    
    /* Remove mobile-specific styles */
    .module,
    .control-module {
        width: 100%;
        min-width: 0;
        max-width: none;
        margin: 0 0 var(--module-spacing-tablet, var(--space-sm)) 0; /* Use responsive spacing */
        scroll-snap-align: none;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
}

/* ===== PORTRAIT MODE (TALL SCREENS) ===== */
/* When aspect ratio is taller than wide - keep mobile layout */
@media (max-aspect-ratio: 1.05/1) {
    /* Portrait mode keeps mobile layout - controls at bottom */
    #main-wrapper {
        flex-direction: column-reverse; /* Portrait: controls at bottom */
    }
    
    /* Sidebar stays at bottom in portrait mode */
    #sidebar {
        /* Inherits mobile styles - already defined above */
        border-top: 1px solid var(--module-border);
        border-left: none;
        border-right: none;
        box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.05);
    }
}

/* ===== LARGE LANDSCAPE SCREENS ===== */
/* Extra wide screens get larger sidebar */
@media (min-aspect-ratio: 1.5/1) and (min-width: 1200px) {
    #sidebar {
        width: var(--sidebar-width-large, 320px); /* Use responsive token */
        gap: var(--space-md); /* Larger spacing for big screens */
    }
}

/* ===== RESPONSIVE MODULE ENHANCEMENTS ===== */
/* Module-specific responsive behavior */

/* Portrait mode: Vertical stacking modules */
@media (max-aspect-ratio: 1.05/1) {
    .module,
    .control-module {
        /* Vertical stacking - already handled in base mobile styles */
        scroll-snap-align: start; /* For vertical scroll snap */
    }
}

/* Landscape mode: Vertical stacking modules in sidebar */
@media (min-aspect-ratio: 1.05/1) {
    .module,
    .control-module {
        flex-shrink: 1;
        scroll-snap-align: none;
    }
}

/* ===== ACCESSIBILITY ENHANCEMENTS ===== */
/* Responsive accessibility improvements */

/* Reduce motion for users who prefer it */
@media (prefers-reduced-motion: reduce) {
    #sidebar {
        scroll-behavior: auto;
        -webkit-overflow-scrolling: auto;
    }
    
    .module,
    .control-module {
        scroll-snap-align: none;
    }
}

/* High contrast mode adjustments */
@media (prefers-contrast: high) {
    #sidebar {
        border-color: var(--text-color);
        box-shadow: none;
    }
    
    .module,
    .control-module {
        border-color: var(--text-color);
        box-shadow: none;
    }
}

/* ===== ORIENTATION SPECIFIC ADJUSTMENTS ===== */
/* Fine-tune for device orientation and aspect ratio */

/* Portrait mode: Optimize for vertical screens */
@media (max-aspect-ratio: 1.05/1) {
    #sidebar {
        max-height: 60vh; /* Balanced for portrait mode */
    }
    
    #main-content {
        height: 40vh;
    }
}

/* Landscape mode: Optimize for wider screens */
@media (min-aspect-ratio: 1.05/1) {
    #sidebar {
        /* Full height sidebar in landscape */
        height: 100vh;
        max-height: 100vh;
    }
    
    #main-content {
        height: 100vh;
    }
}

/* Small landscape screens: Adjust for mobile landscape */
@media (min-aspect-ratio: 1.05/1) and (max-height: 600px) {
    #sidebar {
        min-width: 160px; /* Narrower sidebar for small landscape */
        width: 200px;
    }
}

/* ===== PERFORMANCE OPTIMIZATIONS ===== */
/* Responsive performance enhancements */

/* Portrait mode: Lighter shadows and simpler effects */
@media (max-aspect-ratio: 1.05/1) {
    #sidebar {
        box-shadow: 0 -1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .module,
    .control-module {
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
}

/* Landscape mode: Richer shadows and effects */
@media (min-aspect-ratio: 1.05/1) {
    #sidebar {
        box-shadow: -2px 0 8px rgba(0, 0, 0, 0.1); /* Left shadow for right-side sidebar */
    }
    
    .module,
    .control-module {
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }
}
