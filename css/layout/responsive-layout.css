/* ================= RESPONSIVE LAYOUT SYSTEM ================= */
/* Single source of truth for all layout and responsive behavior */
/* Mobile-first approach with progressive enhancement */

/* ===== MOBILE BASE (DEFAULT) ===== */
/* All base styles optimized for mobile devices */

/* Main Layout Container */
#main-wrapper {
    flex: 1 0 auto;
    display: flex;
    flex-direction: column-reverse; /* Mobile: controls at bottom */
    height: 100vh;
    min-height: 0;
}

/* Sidebar - Mobile: Vertical stacking container */
#sidebar {
    /* Mobile-first defaults */
    width: 100vw;
    max-width: 100vw;
    min-width: 0;
    height: auto;
    max-height: var(--sidebar-height-mobile, 60vh); /* Use responsive token */
    background: var(--control-background);
    border-right: none;
    border-top: 1px solid var(--module-border);
    border-bottom: none;
    display: flex;
    flex-direction: column; /* Changed from row to column for vertical stacking */
    align-items: stretch;
    padding: var(--space-sm);
    gap: var(--module-spacing-mobile, var(--space-sm)); /* Use responsive spacing */
    box-sizing: border-box;
    z-index: 2;
    overflow-x: hidden; /* Changed from auto to hidden */
    overflow-y: auto; /* Changed from hidden to auto */
    position: static;
    bottom: 0;
    top: auto;
    scroll-snap-type: y proximity; /* Changed from x to y */
    scrollbar-width: thin;
    -webkit-overflow-scrolling: touch;
    box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.05);
}

/* Main Content Area */
#main-content {
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    min-width: 0;
    min-height: 0;
    overflow: hidden;
    height: var(--content-height-mobile, 40vh); /* Use responsive token */
}

/* Controls Section */
#controls {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    background-color: var(--control-background);
    padding: var(--space-sm);
}

/* Visualization Section */
#visualization {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    flex: 1;
    min-height: 0;
}

#visualization svg {
    display: block;
    margin: 0 auto;
    width: 100%;
    height: 100%;
    max-height: 100%;
    max-width: 100%;
}

/* Mobile Module Styles - Vertical stacking instead of horizontal scrolling */
.module,
.control-module {
    width: 100%;
    margin: 0 0 var(--space-sm) 0;
    flex-shrink: 0;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
}

/* Mobile scroll indicator - removed as no longer needed for vertical layout */
/* #sidebar::after removed - vertical layout doesn't need horizontal scroll indicator */

/* Mobile last module margin - removed as no longer needed */
/* No special margin needed for last module in vertical layout */

/* ===== TABLET ENHANCEMENT ===== */
/* Progressive enhancement for tablet-sized screens */
@media (min-width: 768px) {
    /* Main Layout: Switch to side-by-side */
    #main-wrapper {
        flex-direction: row; /* Tablet: side-by-side layout */
    }
    
    /* Sidebar: Transition to desktop-like vertical sidebar */
    #sidebar {
        width: var(--sidebar-width-tablet, 250px); /* Use responsive token */
        min-width: 180px;
        max-width: 320px;
        height: 100vh;
        max-height: 100vh;
        border-right: 1px solid var(--module-border);
        border-top: none;
        border-bottom: none;
        flex-direction: column;
        overflow-x: visible;
        overflow-y: auto;
        position: sticky;
        top: 0;
        bottom: auto;
        scroll-snap-type: none;
        scrollbar-width: auto;
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.05);
        gap: var(--module-spacing-tablet, var(--space-sm)); /* Use responsive spacing */
    }
    
    /* Main Content: Full height on tablet */
    #main-content {
        height: 100vh; /* Tablet: full viewport height */
    }
    
    /* Remove mobile-specific styles */
    .module,
    .control-module {
        width: 100%;
        min-width: 0;
        max-width: none;
        margin: 0 0 var(--module-spacing-tablet, var(--space-sm)) 0; /* Use responsive spacing */
        scroll-snap-align: none;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    /* Remove mobile scroll indicator - not needed */
    /* No special indicator needed for tablet vertical layout */
}

/* ===== DESKTOP ENHANCEMENT ===== */
/* Additional enhancements for desktop screens */
@media (min-width: 1024px) {
    /* Desktop-specific optimizations can go here */
    /* Currently inherits tablet styles, which work well for desktop */
}

/* ===== LARGE DESKTOP ENHANCEMENT ===== */
/* Wide screen optimizations */
@media (min-width: 1200px) {
    /* Landscape mode: Sidebar on right for better UX */
    #main-wrapper {
        flex-direction: row-reverse; /* Large desktop: sidebar on right */
    }
    
    #sidebar {
        width: var(--sidebar-width-large, 320px); /* Use responsive token */
        border-right: none;
        border-left: 1px solid var(--module-border);
        box-shadow: -2px 0 5px rgba(0, 0, 0, 0.05);
        gap: var(--space-md); /* Larger spacing for big screens */
    }
}

/* ===== RESPONSIVE MODULE ENHANCEMENTS ===== */
/* Module-specific responsive behavior */

/* Mobile: Vertical stacking modules */
@media (max-width: 767px) {
    .module,
    .control-module {
        /* Vertical stacking - already handled in base mobile styles */
        scroll-snap-align: start; /* For vertical scroll snap */
    }
}

/* Tablet+: Vertical stacking modules */
@media (min-width: 768px) {
    .module,
    .control-module {
        flex-shrink: 1;
        scroll-snap-align: none;
    }
}

/* ===== ACCESSIBILITY ENHANCEMENTS ===== */
/* Responsive accessibility improvements */

/* Reduce motion for users who prefer it */
@media (prefers-reduced-motion: reduce) {
    #sidebar {
        scroll-behavior: auto;
        -webkit-overflow-scrolling: auto;
    }
    
    .module,
    .control-module {
        scroll-snap-align: none;
    }
}

/* High contrast mode adjustments */
@media (prefers-contrast: high) {
    #sidebar {
        border-color: var(--text-color);
        box-shadow: none;
    }
    
    .module,
    .control-module {
        border-color: var(--text-color);
        box-shadow: none;
    }
}

/* ===== ORIENTATION SPECIFIC ADJUSTMENTS ===== */
/* Fine-tune for device orientation */

/* Portrait phones: Optimize for vertical module layout */
@media (max-width: 767px) and (orientation: portrait) {
    #sidebar {
        max-height: 50vh; /* Balanced for portrait */
    }
    
    #main-content {
        height: 50vh;
    }
}

/* Landscape phones: Optimize for wider screens with vertical modules */
@media (max-width: 767px) and (orientation: landscape) {
    #sidebar {
        max-height: 60vh; /* More space for landscape */
    }
    
    #main-content {
        height: 40vh;
    }
}

/* ===== PERFORMANCE OPTIMIZATIONS ===== */
/* Responsive performance enhancements */

/* Mobile: Lighter shadows and simpler effects */
@media (max-width: 767px) {
    #sidebar {
        box-shadow: 0 -1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .module,
    .control-module {
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
}

/* Desktop: Richer shadows and effects */
@media (min-width: 1024px) {
    #sidebar {
        box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
    }
    
    .module,
    .control-module {
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }
}
